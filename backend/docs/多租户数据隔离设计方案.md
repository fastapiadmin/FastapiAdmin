# SaaSå¤šç§Ÿæˆ·æ•°æ®éš”ç¦»è®¾è®¡æ–¹æ¡ˆ

## ğŸ“‹ ç›®å½•
1. [è®¾è®¡æ¦‚è¿°](#è®¾è®¡æ¦‚è¿°)
2. [æ•°æ®éš”ç¦»å±‚çº§](#æ•°æ®éš”ç¦»å±‚çº§)
3. [è¡¨çº§åˆ«éš”ç¦»è§„åˆ™](#è¡¨çº§åˆ«éš”ç¦»è§„åˆ™)
4. [æ•°æ®æƒé™å®ç°](#æ•°æ®æƒé™å®ç°)
5. [SQLæŸ¥è¯¢ç¤ºä¾‹](#sqlæŸ¥è¯¢ç¤ºä¾‹)
6. [æœ€ä½³å®è·µ](#æœ€ä½³å®è·µ)

---

## è®¾è®¡æ¦‚è¿°

æœ¬ç³»ç»Ÿé‡‡ç”¨**ä¸‰å±‚æ•°æ®éš”ç¦»æ¶æ„**:

```
ç³»ç»Ÿå±‚ (System Level)
  â””â”€â”€ ç§Ÿæˆ·å±‚ (Tenant Level)
        â”œâ”€â”€ éƒ¨é—¨/è§’è‰²/ç”¨æˆ·ç­‰ç»„ç»‡æ¶æ„
        â””â”€â”€ å®¢æˆ·å±‚ (Customer Level)
              â””â”€â”€ å®¢æˆ·ç”¨æˆ·åŠä¸šåŠ¡æ•°æ®
```

### æ ¸å¿ƒéš”ç¦»å­—æ®µ

| å­—æ®µ | ç”¨é€” | å¿…å¡«æ€§ |
|------|------|--------|
| `tenant_id` | ç§Ÿæˆ·éš”ç¦»,å®ç°SaaSå¤šç§Ÿæˆ·æ¶æ„ | å¤§éƒ¨åˆ†è¡¨å¿…å¡« |
| `customer_id` | å®¢æˆ·éš”ç¦»,ç§Ÿæˆ·ä¸‹çš„äºŒçº§éš”ç¦» | éƒ¨åˆ†è¡¨å¯é€‰ |
| `created_id` | è®°å½•åˆ›å»ºè€…,ç”¨äºæ•°æ®æƒé™æ§åˆ¶ | å¯é€‰ |
| `updated_id` | è®°å½•æ›´æ–°è€…,ç”¨äºå®¡è®¡è¿½è¸ª | å¯é€‰ |

---

## æ•°æ®éš”ç¦»å±‚çº§

### 1. ç³»ç»Ÿçº§ (tenant_id=1 æˆ– NULL)
**é€‚ç”¨åœºæ™¯**: å¹³å°ç®¡ç†ã€ç³»ç»Ÿé…ç½®

**ç‰¹å¾**:
- ç”±å¹³å°è¶…çº§ç®¡ç†å‘˜ç®¡ç†
- æ‰€æœ‰ç§Ÿæˆ·å…±äº«æˆ–å¯è§
- å¦‚: ç³»ç»Ÿèœå•ã€ç³»ç»Ÿå­—å…¸ã€ç³»ç»Ÿå‚æ•°

**ç¤ºä¾‹è¡¨**: 
- `system_tenant` (ç§Ÿæˆ·è¡¨æœ¬èº«)
- `system_menu` (tenant_id=NULLçš„ç³»ç»Ÿèœå•)
- `system_dict_type` (tenant_id=NULLçš„ç³»ç»Ÿå­—å…¸)

### 2. ç§Ÿæˆ·çº§ (tenant_id>1, customer_id=NULL)
**é€‚ç”¨åœºæ™¯**: ç§Ÿæˆ·å†…éƒ¨ç®¡ç†

**ç‰¹å¾**:
- å±äºç‰¹å®šç§Ÿæˆ·,ç§Ÿæˆ·é—´å®Œå…¨éš”ç¦»
- ç§Ÿæˆ·ç®¡ç†å‘˜å¯ç®¡ç†
- å¦‚: éƒ¨é—¨ã€è§’è‰²ã€å²—ä½ã€ç§Ÿæˆ·ç”¨æˆ·

**ç¤ºä¾‹è¡¨**:
- `system_dept` - éƒ¨é—¨
- `system_role` - è§’è‰²
- `system_position` - å²—ä½
- `system_user` (ç§Ÿæˆ·ç”¨æˆ·)

### 3. å®¢æˆ·çº§ (tenant_id>1, customer_id>1)
**é€‚ç”¨åœºæ™¯**: ç§Ÿæˆ·ä¸‹çš„å®¢æˆ·ä¸šåŠ¡æ•°æ®

**ç‰¹å¾**:
- å±äºç§Ÿæˆ·ä¸‹çš„ç‰¹å®šå®¢æˆ·
- å®¢æˆ·ç”¨æˆ·åªèƒ½è®¿é—®æœ¬å®¢æˆ·æ•°æ®
- å¦‚: å®¢æˆ·ç”¨æˆ·ã€å®¢æˆ·ä¸“å±é€šçŸ¥ã€å®¢æˆ·ä¸šåŠ¡æ•°æ®

**ç¤ºä¾‹è¡¨**:
- `system_user` (å®¢æˆ·ç”¨æˆ·: customer_id>1)
- `system_notice` (å®¢æˆ·é€šçŸ¥: customer_id>1)
- `system_log` (å®¢æˆ·ç”¨æˆ·æ“ä½œæ—¥å¿—)

---

## è¡¨çº§åˆ«éš”ç¦»è§„åˆ™

### å®Œæ•´éš”ç¦»è§„åˆ™è¡¨

| è¡¨å | tenant_id | customer_id | è¯´æ˜ |
|------|-----------|-------------|------|
| **TenantModel** | âŒ | âŒ | ç§Ÿæˆ·è¡¨æœ¬èº«,ä¸éœ€è¦éš”ç¦»å­—æ®µ |
| **CustomerModel** | âœ… å¿…å¡« | âŒ | å®¢æˆ·å±äºç§Ÿæˆ·,ä¸å±äºå®¢æˆ· |
| **UserModel** | âœ… å¿…å¡« | âœ… å¯é€‰ | ç§Ÿæˆ·ç”¨æˆ·(NULL)æˆ–å®¢æˆ·ç”¨æˆ·(>1) |
| **DeptModel** | âœ… å¿…å¡« | âŒ | éƒ¨é—¨æ˜¯ç§Ÿæˆ·çº§ç»„ç»‡æ¶æ„ |
| **RoleModel** | âœ… å¿…å¡« | âŒ | è§’è‰²æ˜¯ç§Ÿæˆ·çº§æƒé™ç®¡ç† |
| **PositionModel** | âœ… å¿…å¡« | âŒ | å²—ä½æ˜¯ç§Ÿæˆ·çº§èŒä½å®šä¹‰ |
| **MenuModel** | âœ… å¯é€‰ | âŒ | NULL=ç³»ç»Ÿèœå•,>1=ç§Ÿæˆ·èœå• |
| **DictTypeModel** | âœ… å¯é€‰ | âŒ | NULL=ç³»ç»Ÿå­—å…¸,>1=ç§Ÿæˆ·å­—å…¸ |
| **DictDataModel** | âœ… å¯é€‰ | âŒ | ç»§æ‰¿å­—å…¸ç±»å‹çš„éš”ç¦»çº§åˆ« |
| **NoticeModel** | âœ… å¿…å¡« | âœ… å¯é€‰ | NULL=ç§Ÿæˆ·é€šçŸ¥,>1=å®¢æˆ·é€šçŸ¥ |
| **OperationLogModel** | âœ… å¿…å¡« | âœ… å¯é€‰ | è®°å½•æ“ä½œäººçš„ç§Ÿæˆ·å’Œå®¢æˆ·ä¿¡æ¯ |
| **ParamsModel** | âœ… å¯é€‰ | âŒ | NULL=ç³»ç»Ÿå‚æ•°,>1=ç§Ÿæˆ·å‚æ•° |

### ä¸šåŠ¡è¡¨éš”ç¦»è§„åˆ™ (ç¤ºä¾‹)

å¯¹äºè‡ªå®šä¹‰ä¸šåŠ¡è¡¨,æ ¹æ®ä¸šåŠ¡åœºæ™¯é€‰æ‹©:

```python
# åœºæ™¯1: ç§Ÿæˆ·çº§ä¸šåŠ¡è¡¨ (æ‰€æœ‰ç§Ÿæˆ·ç”¨æˆ·å…±äº«)
class ProductModel(ModelMixin):
    tenant_id: Mapped[int]  # å¿…å¡«
    customer_id: Mapped[int | None] = None  # ä¸éœ€è¦
    
# åœºæ™¯2: å®¢æˆ·çº§ä¸šåŠ¡è¡¨ (å®¢æˆ·ç”¨æˆ·ç‹¬äº«)
class OrderModel(ModelMixin):
    tenant_id: Mapped[int]  # å¿…å¡«
    customer_id: Mapped[int | None]  # å¯é€‰,å®¢æˆ·è®¢å•æ—¶å¿…å¡«
```

---

## æ•°æ®æƒé™å®ç°

### è§’è‰²æ•°æ®æƒé™ (data_scopeå­—æ®µ)

`RoleModel.data_scope` å®šä¹‰äº†è§’è‰²çš„æ•°æ®è®¿é—®èŒƒå›´:

| å€¼ | åç§° | SQLè¿‡æ»¤æ¡ä»¶ | ä½¿ç”¨åœºæ™¯ |
|----|------|-------------|----------|
| **1** | ä»…æœ¬äººæ•°æ®æƒé™ | `WHERE created_id = current_user.id` | æ™®é€šå‘˜å·¥åªèƒ½çœ‹è‡ªå·±åˆ›å»ºçš„æ•°æ® |
| **2** | æœ¬éƒ¨é—¨æ•°æ®æƒé™ | `WHERE user.dept_id = current_user.dept_id` | éƒ¨é—¨ç»ç†çœ‹æœ¬éƒ¨é—¨æ‰€æœ‰äººçš„æ•°æ® |
| **3** | æœ¬éƒ¨é—¨åŠä»¥ä¸‹æ•°æ®æƒé™ | `WHERE dept.tree_path LIKE 'current_dept.tree_path%'` | æ€»ç›‘çœ‹æœ¬éƒ¨é—¨åŠæ‰€æœ‰ä¸‹çº§éƒ¨é—¨æ•°æ® |
| **4** | å…¨éƒ¨æ•°æ®æƒé™ | `WHERE tenant_id = current_user.tenant_id` | ç§Ÿæˆ·ç®¡ç†å‘˜çœ‹ç§Ÿæˆ·å†…æ‰€æœ‰æ•°æ® |
| **5** | è‡ªå®šä¹‰æ•°æ®æƒé™ | `WHERE dept_id IN (roleå…³è”çš„éƒ¨é—¨åˆ—è¡¨)` | è·¨éƒ¨é—¨æƒé™,å¦‚äººäº‹çœ‹å¤šä¸ªæŒ‡å®šéƒ¨é—¨ |

### æƒé™å åŠ è§„åˆ™

**ä¸€ä¸ªç”¨æˆ·æœ‰å¤šä¸ªè§’è‰²æ—¶**:
1. å–æ‰€æœ‰è§’è‰² `data_scope` çš„**æœ€å¤§å€¼** (4>3>2>5>1)
2. å½“åŒ…å« `data_scope=5` æ—¶,åˆå¹¶æ‰€æœ‰è§’è‰²å…³è”çš„éƒ¨é—¨

**å®¢æˆ·ç”¨æˆ·ç‰¹æ®Šé™åˆ¶**:
- æ— è®º `data_scope` å¦‚ä½•,éƒ½å¿…é¡»é¢å¤–åŠ ä¸Š:
  ```sql
  AND customer_id = current_user.customer_id
  ```
- å³å®¢æˆ·ç”¨æˆ·æ°¸è¿œåªèƒ½çœ‹æœ¬å®¢æˆ·çš„æ•°æ®

---

## SQLæŸ¥è¯¢ç¤ºä¾‹

### 1. ä»…æœ¬äººæ•°æ®æƒé™ (data_scope=1)

```python
# ç§Ÿæˆ·ç”¨æˆ·æŸ¥è¯¢
query = (
    select(OrderModel)
    .where(OrderModel.tenant_id == current_user.tenant_id)
    .where(OrderModel.created_id == current_user.id)
)

# å®¢æˆ·ç”¨æˆ·æŸ¥è¯¢ (é¢å¤–é™åˆ¶å®¢æˆ·)
query = (
    select(OrderModel)
    .where(OrderModel.tenant_id == current_user.tenant_id)
    .where(OrderModel.customer_id == current_user.customer_id)
    .where(OrderModel.created_id == current_user.id)
)
```

### 2. æœ¬éƒ¨é—¨æ•°æ®æƒé™ (data_scope=2)

```python
# æŸ¥è¯¢æœ¬éƒ¨é—¨æ‰€æœ‰ç”¨æˆ·åˆ›å»ºçš„æ•°æ®
dept_user_ids = (
    select(UserModel.id)
    .where(UserModel.dept_id == current_user.dept_id)
)

query = (
    select(OrderModel)
    .where(OrderModel.tenant_id == current_user.tenant_id)
    .where(OrderModel.created_id.in_(dept_user_ids))
)
```

### 3. æœ¬éƒ¨é—¨åŠä»¥ä¸‹æ•°æ®æƒé™ (data_scope=3)

```python
# åˆ©ç”¨ dept.tree_path å­—æ®µé«˜æ•ˆæŸ¥è¯¢
current_tree_path = current_user.dept.tree_path  # å¦‚: /1/3/

# æŸ¥è¯¢æœ¬éƒ¨é—¨åŠæ‰€æœ‰å­éƒ¨é—¨
sub_dept_ids = (
    select(DeptModel.id)
    .where(DeptModel.tree_path.like(f'{current_tree_path}%'))
)

# æŸ¥è¯¢è¿™äº›éƒ¨é—¨çš„æ‰€æœ‰ç”¨æˆ·
dept_user_ids = (
    select(UserModel.id)
    .where(UserModel.dept_id.in_(sub_dept_ids))
)

query = (
    select(OrderModel)
    .where(OrderModel.tenant_id == current_user.tenant_id)
    .where(OrderModel.created_id.in_(dept_user_ids))
)
```

### 4. å…¨éƒ¨æ•°æ®æƒé™ (data_scope=4)

```python
# ç§Ÿæˆ·ç®¡ç†å‘˜ - æŸ¥è¯¢ç§Ÿæˆ·å†…æ‰€æœ‰æ•°æ®
query = (
    select(OrderModel)
    .where(OrderModel.tenant_id == current_user.tenant_id)
)

# å®¢æˆ·ç”¨æˆ· - å³ä½¿æœ‰å…¨éƒ¨æƒé™ä¹Ÿåªèƒ½çœ‹æœ¬å®¢æˆ·
query = (
    select(OrderModel)
    .where(OrderModel.tenant_id == current_user.tenant_id)
    .where(OrderModel.customer_id == current_user.customer_id)
)
```

### 5. è‡ªå®šä¹‰æ•°æ®æƒé™ (data_scope=5)

```python
# è·å–è§’è‰²å…³è”çš„éƒ¨é—¨åˆ—è¡¨
custom_dept_ids = (
    select(RoleDeptsModel.dept_id)
    .join(UserRolesModel, UserRolesModel.role_id == RoleDeptsModel.role_id)
    .where(UserRolesModel.user_id == current_user.id)
)

# æŸ¥è¯¢è¿™äº›éƒ¨é—¨çš„ç”¨æˆ·
dept_user_ids = (
    select(UserModel.id)
    .where(UserModel.dept_id.in_(custom_dept_ids))
)

query = (
    select(OrderModel)
    .where(OrderModel.tenant_id == current_user.tenant_id)
    .where(OrderModel.created_id.in_(dept_user_ids))
)
```

---

## æœ€ä½³å®è·µ

### 1. æ–°å»ºä¸šåŠ¡è¡¨æ—¶çš„å†³ç­–æ ‘

```
æ˜¯å¦éœ€è¦å¤šç§Ÿæˆ·éš”ç¦»?
  â”œâ”€ æ˜¯ â†’ æ·»åŠ  tenant_id (å¿…å¡«)
  â”‚      â””â”€ æ˜¯å¦éœ€è¦å®¢æˆ·çº§éš”ç¦»?
  â”‚           â”œâ”€ æ˜¯ â†’ æ·»åŠ  customer_id (å¯é€‰)
  â”‚           â””â”€ å¦ â†’ ä¸æ·»åŠ  customer_id
  â””â”€ å¦ â†’ ç³»ç»Ÿçº§è¡¨,ä¸æ·»åŠ  tenant_id
```

### 2. æ•°æ®æƒé™è¿‡æ»¤ä¸­é—´ä»¶

å»ºè®®åœ¨ FastAPI ä¾èµ–æ³¨å…¥ä¸­å®ç°æ•°æ®æƒé™è¿‡æ»¤:

```python
from typing import Optional
from sqlalchemy import Select

class DataPermissionFilter:
    """æ•°æ®æƒé™è¿‡æ»¤å™¨"""
    
    def __init__(self, current_user: UserModel):
        self.current_user = current_user
        self.max_data_scope = self._get_max_data_scope()
    
    def _get_max_data_scope(self) -> int:
        """è·å–ç”¨æˆ·æ‰€æœ‰è§’è‰²çš„æœ€å¤§æƒé™èŒƒå›´"""
        if not self.current_user.roles:
            return 1  # é»˜è®¤ä»…æœ¬äºº
        return max(int(role.data_scope) for role in self.current_user.roles)
    
    def apply_filter(self, query: Select, model) -> Select:
        """åº”ç”¨æ•°æ®æƒé™è¿‡æ»¤"""
        # 1. åŸºç¡€ç§Ÿæˆ·éš”ç¦»
        query = query.where(model.tenant_id == self.current_user.tenant_id)
        
        # 2. å®¢æˆ·ç”¨æˆ·é¢å¤–éš”ç¦»
        if self.current_user.customer_id:
            query = query.where(model.customer_id == self.current_user.customer_id)
        
        # 3. æ•°æ®æƒé™è¿‡æ»¤
        if self.max_data_scope == 1:  # ä»…æœ¬äºº
            query = query.where(model.created_id == self.current_user.id)
        
        elif self.max_data_scope == 2:  # æœ¬éƒ¨é—¨
            dept_user_ids = self._get_dept_user_ids(self.current_user.dept_id)
            query = query.where(model.created_id.in_(dept_user_ids))
        
        elif self.max_data_scope == 3:  # æœ¬éƒ¨é—¨åŠä»¥ä¸‹
            sub_dept_user_ids = self._get_sub_dept_user_ids(self.current_user.dept)
            query = query.where(model.created_id.in_(sub_dept_user_ids))
        
        elif self.max_data_scope == 4:  # å…¨éƒ¨æ•°æ®
            pass  # å·²é€šè¿‡ç§Ÿæˆ·éš”ç¦»,æ— éœ€é¢å¤–è¿‡æ»¤
        
        elif self.max_data_scope == 5:  # è‡ªå®šä¹‰
            custom_dept_user_ids = self._get_custom_dept_user_ids()
            query = query.where(model.created_id.in_(custom_dept_user_ids))
        
        return query
```

### 3. æŸ¥è¯¢æ—¶å¿…é¡»æ£€æŸ¥çš„å­—æ®µ

**ä»»ä½•ä¸šåŠ¡æŸ¥è¯¢éƒ½åº”è¯¥åŒ…å«**:
```python
# âœ… æ­£ç¡®çš„æŸ¥è¯¢
query = (
    select(Model)
    .where(Model.tenant_id == current_user.tenant_id)  # å¿…é¡»
    # å¦‚æœç”¨æˆ·æ˜¯å®¢æˆ·ç”¨æˆ·
    .where(Model.customer_id == current_user.customer_id)  # å¿…é¡»
    # ç„¶åå†åº”ç”¨å…¶ä»–ä¸šåŠ¡è¿‡æ»¤
)

# âŒ é”™è¯¯çš„æŸ¥è¯¢ (ç¼ºå°‘ç§Ÿæˆ·éš”ç¦»)
query = select(Model).where(Model.name == 'xxx')  # å±é™©!
```

### 4. å®¡è®¡å­—æ®µçš„ä½¿ç”¨

```python
# åˆ›å»ºè®°å½•æ—¶
new_record = Model(
    tenant_id=current_user.tenant_id,
    customer_id=current_user.customer_id,  # å¦‚æœæ˜¯å®¢æˆ·ç”¨æˆ·
    created_id=current_user.id,
    updated_id=current_user.id,
    # ... å…¶ä»–å­—æ®µ
)

# æ›´æ–°è®°å½•æ—¶
record.updated_id = current_user.id
record.updated_time = datetime.now()
```

### 5. æ ‘å½¢è·¯å¾„ (tree_path) çš„ç»´æŠ¤

```python
def update_dept_tree_path(dept: DeptModel, session: AsyncSession):
    """æ›´æ–°éƒ¨é—¨æ ‘è·¯å¾„"""
    if dept.parent_id:
        parent = session.get(DeptModel, dept.parent_id)
        dept.tree_path = f"{parent.tree_path}{dept.id}/"
    else:
        dept.tree_path = f"/{dept.id}/"
    
    # é€’å½’æ›´æ–°æ‰€æœ‰å­éƒ¨é—¨çš„ tree_path
    for child in dept.children:
        update_dept_tree_path(child, session)
```

### 6. æ€§èƒ½ä¼˜åŒ–å»ºè®®

**ç´¢å¼•**:
```sql
-- å¿…é¡»åˆ›å»ºçš„ç´¢å¼•
CREATE INDEX idx_tenant_id ON table_name(tenant_id);
CREATE INDEX idx_customer_id ON table_name(customer_id);
CREATE INDEX idx_created_id ON table_name(created_id);
CREATE INDEX idx_dept_tree_path ON system_dept(tree_path);

-- è”åˆç´¢å¼• (æé«˜æŸ¥è¯¢æ€§èƒ½)
CREATE INDEX idx_tenant_customer ON table_name(tenant_id, customer_id);
```

**åˆ†åŒºè¡¨** (å½“æ•°æ®é‡å·¨å¤§æ—¶):
```sql
-- æŒ‰ç§Ÿæˆ·åˆ†åŒº
CREATE TABLE orders (
    id BIGINT,
    tenant_id INT,
    -- ...
) PARTITION BY HASH(tenant_id) PARTITIONS 10;
```

---

## é™„å½•: å¸¸è§é—®é¢˜

### Q1: ä¸ºä»€ä¹ˆ TenantModel æ²¡æœ‰ tenant_id?
**A**: ç§Ÿæˆ·è¡¨æœ¬èº«å°±æ˜¯é¡¶å±‚éš”ç¦»å•ä½,å®ƒä¸å±äºä»»ä½•ç§Ÿæˆ·ã€‚å¦‚æœåŠ ä¸Š tenant_id ä¼šå¯¼è‡´å¾ªç¯å¼•ç”¨ã€‚

### Q2: customer_id ä½•æ—¶å¿…å¡«?
**A**: 
- ç”¨æˆ·è¡¨: å½“ `user_type=2` (å®¢æˆ·ç”¨æˆ·)æ—¶å¿…å¡«
- ä¸šåŠ¡è¡¨: å½“è¯¥æ•°æ®ä»…å±äºç‰¹å®šå®¢æˆ·æ—¶å¿…å¡«
- æ—¥å¿—/é€šçŸ¥è¡¨: å½“è®°å½•å®¢æˆ·ç”¨æˆ·æ“ä½œæˆ–å‘é€ç»™å®¢æˆ·æ—¶å¿…å¡«

### Q3: å¦‚ä½•å¤„ç†è·¨ç§Ÿæˆ·çš„åœºæ™¯?
**A**: ç³»ç»Ÿè®¾è®¡ä¸ºä¸¥æ ¼ç§Ÿæˆ·éš”ç¦»,ä¸æ”¯æŒè·¨ç§Ÿæˆ·æŸ¥è¯¢ã€‚å¦‚éœ€è·¨ç§Ÿæˆ·é›†æˆ,åº”é€šè¿‡ API æ¥å£æˆ–æ¶ˆæ¯é˜Ÿåˆ—å®ç°ã€‚

### Q4: å®¢æˆ·ç”¨æˆ·èƒ½å¦æ‹¥æœ‰ data_scope=4 (å…¨éƒ¨æ•°æ®æƒé™)?
**A**: å¯ä»¥,ä½†å®é™…æŸ¥è¯¢æ—¶ä»ä¼šé™åˆ¶ä¸º `customer_id = current_user.customer_id`,å³"å®¢æˆ·å†…çš„å…¨éƒ¨æ•°æ®"ã€‚

### Q5: å¦‚ä½•å®ç°"æŸ¥çœ‹ä¸‹å±æ•°æ®"çš„æƒé™?
**A**: é€šè¿‡éƒ¨é—¨æ ‘ç»“æ„å®ç°:
1. è®¾ç½®é¢†å¯¼ä¸ºéƒ¨é—¨è´Ÿè´£äºº
2. åˆ†é… `data_scope=3` (æœ¬éƒ¨é—¨åŠä»¥ä¸‹)çš„è§’è‰²
3. ç³»ç»Ÿè‡ªåŠ¨é€šè¿‡ `tree_path` æŸ¥è¯¢æ‰€æœ‰ä¸‹çº§éƒ¨é—¨æ•°æ®

---

## ä¿®è®¢å†å²

| ç‰ˆæœ¬ | æ—¥æœŸ | è¯´æ˜ |
|------|------|------|
| v1.0 | 2025-11-22 | åˆå§‹ç‰ˆæœ¬,å®Œæˆæ•°æ®éš”ç¦»è®¾è®¡ |

